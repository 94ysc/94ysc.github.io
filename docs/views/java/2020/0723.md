---
title: 极客时间-后端存储实战课笔记
date: 2020-07-23
tags:
 - mysql
 - 数据库
categories: 
 - java
---

## 如何保证数据幂等

#### 新增

对于创建订单服务来说，可以通过预先生成订单号，然后利用数据库中订单号的唯一约束这个特性，避免重复写入订单，实现创建订单服务的幂等性。

#### 修改

对于更新订单服务，可以通过一个版本号机制，每次更新数据前校验版本号，更新数据同时自增版本号，这样的方式，来解决 ABA 问题，确保更新订单服务的幂等性。

#### 以往自己的实现

记录请求参数进行hash存储到redis过期时间2~3秒,重复请求的hash一致,以保证幂等性

## Elasticsearch 搜索提示

es提供suggestion api支持前缀匹配,结合拼音分词可以实现拼音匹配中文

## mysql数据同步

Canal 模拟mysql节点接受mysql binlog 然后分发到MQ,经过MQ发送到需要同步的模块